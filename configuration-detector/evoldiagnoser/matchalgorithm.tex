\begin{figure}[t]
\textbf{Input}: two methods from two software versions: $\mathit{m_{old}}$ and $m_{new}$,

\quad a similarity threshold $\mathit{s}$, and a maximum lookahead value $\mathit{lh}$. 

\quad Our experiment uses $\mathit{s}=0.9$ and $\mathit{lh}=5$.\\
\textbf{Output}: matched statements between old and new versions.
\vspace{-4mm}%
matchStatements($\mathit{m_{old}}$, $\mathit{m_{new}}$, $\mathit{s}$, $\mathit{lh}$)\\
\begin{algorithmic}[1]
\STATE $\mathit{matchedStmts}$ $\leftarrow$ new Map$\langle$Stmt, Stmt$\rangle$
\STATE $\mathit{cfg_{old}}$ $\leftarrow$ constructControlFlowGraph($\mathit{m_{old}}$)
\STATE $\mathit{cfg_{new}}$ $\leftarrow$ constructControlFlowGraph($\mathit{m_{new}}$)
\STATE $\mathit{stack}$ $\leftarrow$ new Stack$\langle$Stmt, Stmt$\rangle$
\STATE $\mathit{stack}$.push($\mathit{cfg_{old}}$.$\mathit{entry}$, $\mathit{cfg_{new}}$.$\mathit{entry}$)
\WHILE{$\mathit{stack}$ is not empty}
\STATE $\langle$$\mathit{stmt_{old}}$, $\mathit{stmt_{new}}$$\rangle$ $\leftarrow$ $\mathit{stack}$.pop()
%\IF{$\mathit{stmt_{old}}$ or $\mathit{stmt_{new}}$ has already been matched}
\IF{$\mathit{matchedStmts}$.keys().contains($\mathit{stmt_{old}}$) \\ \quad || $\mathit{matchedStmts}$.values().contains($\mathit{stmt_{new}}$)}
\STATE \textbf{continue}
\ENDIF
\IF{$\mathit{stmt_{old}}$ = $\mathit{stmt_{new}}$}
\STATE $\mathit{matchedStmts}$[$\mathit{stmt_{old}}$] = $\mathit{stmt_{new}}$
\ELSE
\STATE $\mathit{nodeList_{old}}$ $\leftarrow$ reachableSuccStmtsInOrder($\mathit{stmt_{old}}$, $\mathit{lh}$)
\STATE $\mathit{nodeList_{new}}$ $\leftarrow$ reachableSuccStmtsInOrder($\mathit{stmt_{new}}$, $\mathit{lh}$)
\FOR{each $\mathit{s_{old}}$ in $\mathit{nodeList_{old}}$}
\FOR{each $\mathit{s_{new}}$ in $\mathit{nodeList_{new}}$}
\IF{$\mathit{s_{old}}$ = $\mathit{s_{new}}$}
\STATE $\mathit{matchedStmts}$[$\mathit{s_{old}}$] = $\mathit{s_{new}}$
\FOR{each $\mathit{succ_{old}}$ in succ($\mathit{s_{old}}$)}
\FOR{each $\mathit{succ_{new}}$ in succ($\mathit{s_{new}}$)}
\STATE $\mathit{stack}$.push($\langle$$\mathit{succ_{old}}$, $\mathit{succ_{new}}$$\rangle$)
\ENDFOR
\ENDFOR
\STATE Break two for loops outside.
%\STATE $\mathit{stack}$.push($\langle$$\mathit{s_{old}}$, $\mathit{s_{new}}$$\rangle$)
\ENDIF
\ENDFOR
\ENDFOR
\ENDIF
\ENDWHILE
\RETURN $\mathit{matchedStmts}$
\end{algorithmic}
\vspace{-4mm}
\caption{Algorithm for matching two program versions.
\label{fig:matching}
}
\end{figure}
